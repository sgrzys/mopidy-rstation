

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Preparing your Raspberry Pi &mdash; pi-jukebox 0.1a documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="pi-jukebox 0.1a documentation" href="index.html"/>
        <link rel="prev" title="Auto Generated Documentation" href="code.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> pi-jukebox
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="code.html">Auto Generated Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code.html#mpc-control-py-controlling-and-monitoring-mpd-via-mpc"><strong>mpc_control.py</strong>: controlling and monitoring mpd via mpc.</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Preparing your Raspberry Pi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hardware">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-the-operating-system">Installing the operating system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-raspberry-pi">Configuring the Raspberry Pi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-usb-music-device">Configuring the USB music device</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-and-configuring-mpd">Installing and configuring mpd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-music-library">Setting up the music library</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zeroconf">Zeroconf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#samba-server">Samba server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wifi">WiFi</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">pi-jukebox</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Preparing your Raspberry Pi</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/raspberry_pi.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="preparing-your-raspberry-pi">
<h1>Preparing your Raspberry Pi<a class="headerlink" href="#preparing-your-raspberry-pi" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h2>
<p>For my raspberry pi jukebox I used the following hardware:</p>
<blockquote>
<div><ul class="simple">
<li>Raspberry Pi, I used a B+ model, but any will model do as long as it fits with the:</li>
<li>Capacitive Touchscreen from Adafruit: <a class="reference external" href="http://www.adafruit.com/products/2423">http://www.adafruit.com/products/2423</a></li>
<li>8 GB SD card</li>
<li>USB audiocard (since the jack output on the Raspberry Pi gave me too much of a headache)</li>
</ul>
</div></blockquote>
<p>I also built my own case with speakers and in-built amp, but I&#8217;ll spare you these ;-).</p>
</div>
<div class="section" id="installing-the-operating-system">
<h2>Installing the operating system<a class="headerlink" href="#installing-the-operating-system" title="Permalink to this headline">¶</a></h2>
<p>I installed a raspbian pre-configured for the Capacitive touchscreen with an image downloaded from this page: <a class="reference external" href="https://learn.adafruit.com/adafruit-2-8-pitft-capacitive-touch/easy-install">https://learn.adafruit.com/adafruit-2-8-pitft-capacitive-touch/easy-install</a>. Since the installation instructions differ per operating system and provided on this page are quite good, you can follow these.</p>
</div>
<div class="section" id="configuring-the-raspberry-pi">
<h2>Configuring the Raspberry Pi<a class="headerlink" href="#configuring-the-raspberry-pi" title="Permalink to this headline">¶</a></h2>
<p>You can configure some settings on your Raspberry Pi using the command sudo raspi-config Here you can easily do some configurations. Some that I preferred to do:</p>
<blockquote>
<div><ul class="simple">
<li>Expand the file-system (1) - The initial installation of the OS does not make full use of your SD card. Why throw away so much space?. This option makes sure you use your whole SD card.</li>
<li>Internationalization options (4) - Configure your timezone and locale settings</li>
<li>Advanced options (8) - Host name (A2) - Of course you want your Pi-Jukebox recognizable in the network as such, so change it to &#8216;pi-jukebox&#8217;. This step is not a necessity for following steps.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configuring-the-usb-music-device">
<h2>Configuring the USB music device<a class="headerlink" href="#configuring-the-usb-music-device" title="Permalink to this headline">¶</a></h2>
<p>To configure the sound card&#8217;s initial volume I used alsamixer. Because we want to configure the USB soundcard, and not the HDMI or jack output we use the -c 1 switch, like so:</p>
<div class="highlight-bash"><div class="highlight"><pre>alsamixer -c 1
</pre></div>
</div>
<p>Since we want to make sure the volume settings are kept on reboot we use:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo alsactl store
</pre></div>
</div>
</div>
<div class="section" id="installing-and-configuring-mpd">
<h2>Installing and configuring mpd<a class="headerlink" href="#installing-and-configuring-mpd" title="Permalink to this headline">¶</a></h2>
<p>First, we&#8217;ll just install mpd.</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install mpd mpc
</pre></div>
</div>
<p>Then we configure mpd&#8217;s settings with:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo nano /etc/mpd.conf
</pre></div>
</div>
<p>Some mpd clients use zero-conf so that accessing the mpd is made extremely easy. For that I will install the necessary components in a later step. For now we can already set-up the feature in the config by un-comment the line containing:</p>
<div class="highlight-bash"><div class="highlight"><pre>zeroconf_enabled        <span class="s2">&quot;yes&quot;</span>
</pre></div>
</div>
<p>and change the line for the zero-conf name so becomes:</p>
<div class="highlight-bash"><div class="highlight"><pre>zeroconf_name           <span class="s2">&quot;Pi-Jukebox&quot;</span>
</pre></div>
</div>
<div class="section" id="last-fm-scrobbling">
<h3>last.fm scrobbling<a class="headerlink" href="#last-fm-scrobbling" title="Permalink to this headline">¶</a></h3>
<p>Since I have an last.fm account I also want to scrobble my plays to it. Luckily a nice little tool called mpdscribble allows us to do just that. Install it with</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install mpdscribble
</pre></div>
</div>
<p>Configure it:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo nano /etc/default/mpdscribble
</pre></div>
</div>
<p>Here we change &#8220;MPD_SYSTEMWIDE=0&#8221; to &#8220;MPD_SYSTEMWIDE=1&#8221; and add the lines:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>last.fm<span class="o">]</span>
<span class="nv">url</span><span class="o">=</span>http://post.audioscrobbler.com/
<span class="nv">username</span><span class="o">=</span>_yourusername_
<span class="nv">password</span><span class="o">=</span>_yourpassword_
<span class="nv">journal</span><span class="o">=</span>/var/cache/mpdscribble/lastfm.journal   <span class="c"># The file where mpdscribble should store its Last.fm journal in case you do not have a connection to the Last.fm server.</span>
</pre></div>
</div>
</div>
<div class="section" id="last-fm-suggestions">
<h3>last.fm suggestions<a class="headerlink" href="#last-fm-suggestions" title="Permalink to this headline">¶</a></h3>
<p>Wouldn&#8217;t it be neat if your playlist would be supplemented with music similar to the last track in your playlist? A tool called mpd-sima does just that. We install and start it with:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install mpd-sima
sudo service mpd-sima start
</pre></div>
</div>
<p>This automatically adds 1 track whenever your player reaches the last track in your current playlist. You can change some of it&#8217;s behaviour by editing the, self explanatory, configuration file and restarting the service after that:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo nano /etc/mpd-sima.cfg
sudo service mpd-sima restart
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-up-the-music-library">
<h2>Setting up the music library<a class="headerlink" href="#setting-up-the-music-library" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setting-up-the-nas-drive">
<h3>Setting up the NAS drive<a class="headerlink" href="#setting-up-the-nas-drive" title="Permalink to this headline">¶</a></h3>
<p>My NAS drive contains a publicly (LAN public) available directory called Public, which in turn contains my music folder surprisingly called &#8216;Music&#8217;.</p>
<div class="section" id="mounting-the-nas">
<h4>Mounting the NAS<a class="headerlink" href="#mounting-the-nas" title="Permalink to this headline">¶</a></h4>
<p>For mpd to be able to make use of your NAS drive you need to mount it at boot time. First create a directory where the NAS drive will be mounted:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo mkdir /mnt/nas_drive
</pre></div>
</div>
<p>Then, to make sure the drive mounts on boot, edit fstab:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo nano /etc/fstab
</pre></div>
</div>
<p>and add something along the following line</p>
<div class="highlight-bash"><div class="highlight"><pre>//_your.nas.drive.ip_/Public /mnt/nas_drive cifs guest,uid<span class="o">=</span>1000,gid<span class="o">=</span>1000,iocharset<span class="o">=</span>utf8 0 0
</pre></div>
</div>
<p>Now everything should be ready to mount the NAS at boot. To mount without rebooting now (and test whether it works), do:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo mount -a
</pre></div>
</div>
<p>Hopefully you didn&#8217;t get an error message. See if the NAS content is available on your Pi-Jukebox, do:</p>
<div class="highlight-bash"><div class="highlight"><pre>ls -l /mnt/nas_drive
</pre></div>
</div>
<p>Does the output look familiar? Then everything should be fine</p>
</div>
<div class="section" id="making-the-nas-available-for-mpd">
<h4>Making the NAS available for mpd<a class="headerlink" href="#making-the-nas-available-for-mpd" title="Permalink to this headline">¶</a></h4>
<p>In order for mpd to be able to scan the music on the NAS we must make a link to the NAS drive in the directory where mpd scans it&#8217;s music. Keep in mind that I stored my music in a subdirectory called &#8216;Music&#8217; of the just mounted directory &#8216;Public&#8217;. Make the link like so:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo ln -s /mnt/nas_drive/Music/  /var/lib/mpd/music/
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-up-usb-stick-configuration">
<h3>Setting up USB stick configuration<a class="headerlink" href="#setting-up-usb-stick-configuration" title="Permalink to this headline">¶</a></h3>
<p>Because I wanted to make sure I was able to access the USB stick, whatever name it might have, I made use of usbmount. This utility mounts all usb drives in the directory /media in subdirectories called usb0,usb1 and so on.</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install usbmount
</pre></div>
</div>
<p>To make the mounted (or future mounted) USB sticks available to mpd scanning we also make a link to these:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo ln -s /media/ /var/lib/mpd/music/
</pre></div>
</div>
</div>
</div>
<div class="section" id="zeroconf">
<h2>Zeroconf<a class="headerlink" href="#zeroconf" title="Permalink to this headline">¶</a></h2>
<p>Zeroconf, sometimes called bonjour, is a group of utilities that allows for easy networking without special configuration or any manual operations. I also wanted the possibility to control the Pi-Jukebox from other devices within the network I thought this would be a useful addition. The installation is quite straightforward:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install libnss-mdns
</pre></div>
</div>
<p>Starting the zeroconf deamon:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo service avahi-daemon restart
</pre></div>
</div>
</div>
<div class="section" id="samba-server">
<h2>Samba server<a class="headerlink" href="#samba-server" title="Permalink to this headline">¶</a></h2>
<p>We need to put the pi-jukebox program on the device, and it is also nice if we can access the USB storage devices so we can put some files on them. For this we&#8217;re going to create two window shares. One for the home directory of the user &#8216;pi&#8217; and one for the USB mount directory.</p>
<p>First we&#8217;re going to install samba and related packages:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install samba samba-common-bin
</pre></div>
</div>
<p>Now we create the shares by editing the samba config:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo nano /etc/samba/smb.conf
</pre></div>
</div>
<p>and adding the entries</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>pihome<span class="o">]</span>
   <span class="nv">comment</span><span class="o">=</span> Pi Home
   <span class="nv">path</span><span class="o">=</span>/home/pi
   <span class="nv">browseable</span><span class="o">=</span>Yes
   <span class="nv">writeable</span><span class="o">=</span>Yes
   only <span class="nv">guest</span><span class="o">=</span>no
   create <span class="nv">mask</span><span class="o">=</span>0777
   directory <span class="nv">mask</span><span class="o">=</span>0777
   <span class="nv">public</span><span class="o">=</span>no

<span class="o">[</span>piusb<span class="o">]</span>
   <span class="nv">comment</span><span class="o">=</span> Pi USB drives
   <span class="nv">path</span><span class="o">=</span>/media
   <span class="nv">browseable</span><span class="o">=</span>Yes
   <span class="nv">writeable</span><span class="o">=</span>Yes
   only <span class="nv">guest</span><span class="o">=</span>no
   create <span class="nv">mask</span><span class="o">=</span>0777
   directory <span class="nv">mask</span><span class="o">=</span>0777
   <span class="nv">public</span><span class="o">=</span>no
</pre></div>
</div>
<p>Then we&#8217;re going to set the samba user pi&#8217;s password. I&#8217;m going to share a big secret here: I kept it the same as the default pi account: &#8216;raspberry&#8217;</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo smbpasswd -a pi
</pre></div>
</div>
<p>To make the changes effective we&#8217;re going to restart the samba server:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo service samba restart
</pre></div>
</div>
</div>
<div class="section" id="wifi">
<h2>WiFi<a class="headerlink" href="#wifi" title="Permalink to this headline">¶</a></h2>
<p>Yes.... Wait and see</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="code.html" class="btn btn-neutral" title="Auto Generated Documentation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Mark Zwart.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>